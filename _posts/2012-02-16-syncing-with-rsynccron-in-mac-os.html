---
layout: post
title: Syncing with Rsync/Cron in Mac OS
tags:
- jobstuff
status: publish
type: post
published: true
meta:
  jabber_published: '1329404434'
---
[gallery] </div> </p>  <p>With that mess complete, I could now SSH into my Mac Mini from the office using a command like the one below (replacing the X's with your Time Capsule IP address):</p>  <div class="codez"><code class="terminal">ssh <a href="mailto:jvmini@XXX.XX.X.X">jvmini@XXX.XX.X.X</a></code></div>  <p>I could now complete a successful rsync sync for the first time as well (command is all one line):</p>  <div class="codez"><code class="terminal">rsync -avz --progress /Users/jv/Desktop/forotherbooks/ <a href="mailto:jvmini@XXX.XX.X.X">jvmini@XXX.XX.X.X</a>:/Users/jmini/Desktop/fromotherbooks </code></div>  <h2>Step 2: Public Key Authentication</h2>  <p>Hooray!  Since I knew I wanted to end up being able to do this automatically, entering the password each time wasn't going to be an option.  We use public key authentication for a few things in the office, so I had an idea of getting that set up, but if you are new to that game, check out <a href="http://macnugget.org/projects/publickeys/">this guide</a>.  Here's the run-down of the commands used:</p>  <div class="codez"><code class="terminal"> ssh-keygen -t dsa<br /> scp ~/.ssh/id_dsa.pub <a href="mailto:jvmini@XXX.XX.X.X">jvmini@XXX.XX.X.X</a>:.ssh/authorized_keys<br /> ssh jvmini<br /> </code></div>  <h2>Step 3: Enter the Cron</h2>  <p>Now I had sync set up and working, but the automated part was still missing.  For that, I needed cron.  <a href="http://en.wikipedia.org/wiki/Cron">Cron</a> is a UNIX tool for scheduling jobs - pretty cool if you want to automate stuff and have it run on schedule.  I didn't have any experience with cron at all, so it took me a little while to get a handle on it.  Basically, there are two parts: the <strong>script</strong> and the <strong>cron table</strong>.</p>  <p>The script I wrote wasn't too complicated - essentially sync everything up, and the delete all the old files from the local directory.:</p>  <div class="codez"><code class="terminal"> #!/bin/bash <span class="comment"># This says which interpreter you want to run the script under (in this case bash)</span><p /> RSYNC=/usr/bin/rsync  <span class="comment"># this tells the interpreter where to find rsync (run 'which rsync' to be sure)</span><br /> SSH=ssh   <span class="comment"># find SSH in the same place as rsync</span><br /> LPATH=/Users/jeff/Desktop/otherbooks/   <span class="comment"># read: "where is the local computer path you wish to sync?"</span><br /> RPATH=jeffmini:/Users/jeffmini/Desktop/fromotherbooks   <span class="comment"># read: "And what about the remote path?"</span><p /> echo "Syncing and it feels so good" <span class="comment"># I put this mostly for myself.</span><p /> $RSYNC -avz --progress $LPATH $RPATH &gt;&gt; /tmp/output.txt   <span class="comment"># this is the rsync command, and then '&gt;&gt;' tells the interp to put the output into a text file (like a log)</span><br /> cd $LPATH   <span class="comment"># CD into the local path</span><br /> rm *    <span class="comment"># delete all the files that are left in there after the sync</span><br /> </code></div>  <p>I saved this under the title <em>sync_books.sh</em> and saved it for now in my Home directory.</p>  <p>Next was setting up the cron table.  Cron table is a config file where your list of jobs are for executing.  This step was a bit tricky, since the normal command</p>  <div class="codez"><code class="terminal">crontab -e</code></div>  <p>Wasn't working properly for whatever reason.  I blame Apple but that's ok.  I found a workaround, which is to use the editor <a href="http://www.gentoo.org/doc/en/nano-basics-guide.xml">Nano</a>, rather than VIM, to edit the crontab file.  In retrospect, this makes sense, since Apple has been tried deprecating the use of cron in favor of something called launchd.  Anyway, here's the command for opening the crontable in Nano:</p>  <div class="codez"><code class="terminal"> EDITOR=nano crontab -e </code></div>  <p>This opened up the cron table, so I could add a new line to it.  Cron tables (or at least my limited understanding of them) have syntax like so:</p>  <div class="codez"><code class="terminal"> * * * * * command to be executed </code></div>  <p>The asterisks in this case stand for [min (0-59), hour (0-23), day (1-31), month (1-12), day of week (0-7, 0 and 7 are Sunday).  A great tutorial for Cron table syntax is over at <a href="http://adminschoice.com/crontab-quick-reference">Admins Choice</a>.</p>  <h2>Step 4: Testing</h2>  <p>Since I was setting up the cron job to run once a week (2am Sundays), I didn't want to wait that long to make sure it worked.  A one-line addition to my cron table file ran the cron script immediately:</p>  <div class="codez"><code class="terminal"> */1 * * * * /Users/jv/sync_books.sh </code></div>  <p>And then running a tail command in the terminal, to track updates to that "output.txt" file:</p>  <div class="codez"><code class="terminal">tail -f output.txt</code></div>  <p>And a minute later, voila! Syncing was complete!  Now I can dump all the stuff I want to access on the Mac Mini (or archive) without clogging the network, or dumping it into the Time Machine abyss.  Enjoy, and let me know if you have any questions!</p>        </div>
